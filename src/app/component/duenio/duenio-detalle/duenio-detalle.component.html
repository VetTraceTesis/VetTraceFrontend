<div class="profile-container" *ngIf="duenio">
  <mat-tab-group>

    <!-- TAB DUEÑO -->
    <mat-tab label="Dueño">
      <div class="profile-details">
        <div class="profile-info">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nombre</mat-label>
            <input
              matInput
              [(ngModel)]="duenio.nombre"
              [disabled]="disableFields"
              placeholder="Nombre del Dueño"
              required
              #nombre="ngModel"
              [ngClass]="{ 'is-invalid': nombre.invalid && nombre.touched }"
            />
            <mat-error *ngIf="nombre.invalid && nombre.touched">El nombre es obligatorio.</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Apellido</mat-label>
            <input
              matInput
              [(ngModel)]="duenio.apellido"
              [disabled]="disableFields"
              placeholder="Apellido del Dueño"
              required
              #apellido="ngModel"
              [ngClass]="{ 'is-invalid': apellido.invalid && apellido.touched }"
            />
            <mat-error *ngIf="apellido.invalid && apellido.touched">El apellido es obligatorio.</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Contacto</mat-label>
            <input
              matInput
              type="tel"
              [(ngModel)]="duenio.telefono"
              [disabled]="disableFields"
              placeholder="Número de contacto"
              required
              pattern="^[0-9]{9}$"
              #telefono="ngModel"
              [ngClass]="{ 'is-invalid': telefono.invalid && telefono.touched }"
            />
            <mat-error *ngIf="telefono.invalid && telefono.touched">El número de teléfono debe tener 9 dígitos.</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input
              matInput
              type="email"
              [(ngModel)]="duenio.email"
              [disabled]="disableFields"
              placeholder="Email del Dueño"
              required
              email
              #email="ngModel"
              [ngClass]="{ 'is-invalid': email.invalid && email.touched }"
            />
            <mat-error *ngIf="email.invalid && email.touched">Debe ser un correo válido.</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
          <mat-label>Género</mat-label>
         <mat-select [(ngModel)]="duenio.genero" [disabled]="disableFields">
              <mat-option *ngFor="let g of genero" [value]="g">{{ g }}</mat-option>
            </mat-select>
        </mat-form-field>


          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Distrito</mat-label>
            <input
              matInput
              [(ngModel)]="duenio.distrito"
              [matAutocomplete]="auto"
              (ngModelChange)="filterDistricts($event)"
              [disabled]="disableFields"
              placeholder="Escribe o selecciona un distrito"
              required
              #distrito="ngModel"
              [ngClass]="{ 'is-invalid': distrito.invalid && distrito.touched }"
            />
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option *ngFor="let d of filteredDistricts" [value]="d">{{ d }}</mat-option>
            </mat-autocomplete>
            <mat-error *ngIf="distrito.invalid && distrito.touched">El distrito es obligatorio.</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Dirección</mat-label>
            <input
              matInput
              [(ngModel)]="duenio.direccion"
              [disabled]="disableFields"
              placeholder="Dirección del Dueño"
              required
              #direccion="ngModel"
              [ngClass]="{ 'is-invalid': direccion.invalid && direccion.touched }"
            />
            <mat-error *ngIf="direccion.invalid && direccion.touched">La dirección es obligatoria.</mat-error>
          </mat-form-field>

          <div class="botons-style">
            <button
              mat-flat-button
              color="primary"
              (click)="saveDuenio()"
              [disabled]="!nombre.valid || !apellido.valid || !telefono.valid || !email.valid  || !distrito.valid || !direccion.valid"
            >
              Guardar
            </button>
            <button
              mat-flat-button
              [color]="duenio.idestado === 1 ? 'warn' : 'accent'"
              (click)="duenio.idestado = duenio.idestado === 1 ? 0 : 1"
            >
              {{ duenio.idestado === 1 ? 'Desactivar' : 'Activar' }}
            </button>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- TAB MASCOTAS -->
    <mat-tab label="Mascotas">
      <div class="mascotas-section">
        <!-- Listado de mascotas -->
        <div *ngIf="!selectedMascota" class="mascotas-cards">
          <h3>Mascotas asociadas al dueño:</h3>
          <button mat-flat-button color="primary" (click)="openMascotaModal()">Añadir Mascota</button>
          <div class="card-container">
            <mat-card class="mascota-card" *ngFor="let mascota of mascotas" [ngClass]="{ 'inactive-card': mascota.idEstado === 0 }">
              <mat-card-content>
                <h4>{{ mascota.nombre }}</h4>
                <p>{{ mascota.especie }} - {{ mascota.edad }} años</p>
                <button mat-button color="accent" (click)="viewMascotaDetail(mascota)">Ver Detalle</button>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <!-- Detalle de la mascota seleccionada -->
        <div *ngIf="selectedMascota" class="mascota-detail">
         
           <div class="profile-photo-container">
  <div class="profile-photo">
    <!-- Vista previa -->
    <img
      *ngIf="previewUrl"
      [src]="previewUrl"
      alt="Vista previa de la mascota"
      class="mascota-image"
    />

    <!-- Imagen existente desde BD -->
    <img
      *ngIf="!previewUrl && selectedMascota?.rutaimagen"
      [src]="'http://102.37.216.79:80' + selectedMascota.rutaimagen"
      alt="Imagen actual"
      class="mascota-image"
    />
  </div>

  <!-- input fuera del círculo -->
  <input
    type="file"
    (change)="onFileSelected($event)"
    accept="image/*"
    class="file-input"
  />
</div>
 


          <div class="profile-info">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nombre Mascota</mat-label>
              <input matInput [(ngModel)]="selectedMascota.nombre" [disabled]="disableFields" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Especie</mat-label>
              <input matInput [(ngModel)]="selectedMascota.especie" [disabled]="disableFields" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Edad</mat-label>
              <input matInput type="number" [(ngModel)]="selectedMascota.edad" [disabled]="disableFields" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Fecha de Nacimiento</mat-label>
              <input
                matInput
                [matDatepicker]="picker2"
                [(ngModel)]="selectedMascota.fecharegistro"
                [disabled]="disableFields"
                placeholder="Selecciona fecha"
              />
              <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
            </mat-form-field>

            <div class="botons-style">
              <button mat-flat-button color="primary" (click)="saveMascota()">Guardar</button>
              <button mat-flat-button [color]="selectedMascota.idEstado === 1 ? 'warn' : 'accent'" (click)="selectedMascota.idEstado = selectedMascota.idEstado === 1 ? 0 : 1">
                {{ selectedMascota.idEstado === 1 ? 'Desactivar' : 'Activar' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
